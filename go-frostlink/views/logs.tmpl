{{ define "logs" }}
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="/img/logo.ico">
    <title>FrostLink â€¢ Request Logs</title>
    <link rel="stylesheet" href="/css/global.css" />
    <link rel="stylesheet" href="/css/sidebar.css" />
    <link rel="stylesheet" href="/css/logs.css" />
</head>

<body class="page-logs">
    <div class="app">
        {{ template "sidebar" . }}

        <main class="content" role="main" aria-labelledby="page-title">
            <header class="page-header">
                <h1 id="page-title">Request Logs</h1>
                <p class="subtitle">View detailed request logs for resources</p>
            </header>

            <section class="panel" aria-label="Request Logs">
                <div class="toolbar">
                    <div class="left">
                        <label class="input-icon" aria-label="Search sites">
                            <span class="icon" aria-hidden="true">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                    <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"></circle>
                                    <path d="M21 21l-3.5-3.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                                </svg>
                            </span>
                            <input type="search" placeholder="Search sites...">
                        </label>
                    </div>
                    <div class="right">
                        <button class="btn ghost" type="button">
                            <span class="icon orange" aria-hidden="true">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                    <path d="M21 12a9 9 0 1 1-2.64-6.36" stroke="currentColor" stroke-width="2"></path>
                                    <path d="M21 3v6h-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                                </svg>
                            </span>
                            <span>Refresh</span>
                        </button>
                        <button class="btn ghost" type="button">
                            <span class="icon orange" aria-hidden="true">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                    <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                                </svg>
                            </span>
                            <span>Export CSV</span>
                        </button>
                    </div>
                </div>

                <div class="table-wrap">
                    <table class="table" role="grid">
                        <thead>
                            <tr>
                                <th scope="col">Timestamp</th>
                                <th scope="col">Action</th>
                                <th scope="col">IP</th>
                                <th scope="col">Location</th>
                                <th scope="col">Host</th>
                                <th scope="col">Path</th>
                                <th scope="col">Method</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Live logs will be populated from /api/logs -->
                        </tbody>
                    </table>
                </div>

                <div class="pager">
                    <div class="page-info">Page 1 of 1</div>
                    <div class="page-controls">
                        <button class="btn small ghost" aria-label="First page">
                            <span class="icon" aria-hidden="true">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M18 6l-6 6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                                    <path d="M12 6l-6 6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                                </svg>
                            </span>
                        </button>
                        <button class="btn small ghost" aria-label="Previous page">
                            <span class="icon" aria-hidden="true">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M15 6l-6 6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                                </svg>
                            </span>
                        </button>
                        <button class="btn small ghost" aria-label="Next page">
                            <span class="icon" aria-hidden="true">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                                </svg>
                            </span>
                        </button>
                        <button class="btn small ghost" aria-label="Last page">
                            <span class="icon" aria-hidden="true">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M6 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                                    <path d="M12 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                                </svg>
                            </span>
                        </button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        (function () {
            const card = document.querySelector('.profile-card');
            if (!card) return;
            const img = card.querySelector('.avatar');
            const fallback = card.querySelector('.avatar-fallback');
            const nameEl = card.querySelector('.username');
            const initial = (nameEl && nameEl.textContent || '').trim().charAt(0).toUpperCase() || '?';
            if (fallback) { fallback.textContent = initial; }
            function showFallback() { if (img) { img.style.display = 'none'; } if (fallback) { fallback.style.display = 'grid'; } }
            if (!img || !img.getAttribute('src')) { showFallback(); }
            else { img.addEventListener('error', showFallback); }
        })();

        // Load live request logs from /api/logs and populate the table
        (function () {
            const tableBody = document.querySelector('.table tbody');
            if (!tableBody) return;

            function render() {
                fetch('/api/logs')
                    .then(r => r.ok ? r.json() : Promise.reject(r.status))
                    .then(data => {
                        const logs = (data && data.logs) || [];
                        tableBody.innerHTML = '';
                        logs.forEach(entry => {
                            const tr = document.createElement('tr');

                            const tdTs = document.createElement('td');
                            tdTs.textContent = entry.timestamp || '';

                            const tdAction = document.createElement('td');
                            tdAction.textContent = entry.action || '';

                            const tdIP = document.createElement('td');
                            tdIP.textContent = entry.ip || '';

                            const tdLoc = document.createElement('td');
                            tdLoc.textContent = entry.location || '';

                            const tdHost = document.createElement('td');
                            tdHost.textContent = entry.host || '';

                            const tdPath = document.createElement('td');
                            tdPath.textContent = entry.path || '';

                            const tdMethod = document.createElement('td');
                            tdMethod.textContent = entry.method || '';

                            tr.appendChild(tdTs);
                            tr.appendChild(tdAction);
                            tr.appendChild(tdIP);
                            tr.appendChild(tdLoc);
                            tr.appendChild(tdHost);
                            tr.appendChild(tdPath);
                            tr.appendChild(tdMethod);

                            tableBody.appendChild(tr);
                        });
                    })
                    .catch(err => {
                        console.error('Failed to load /api/logs', err);
                    });
            }

            render();

            const refreshBtn = document.querySelector('.toolbar .btn.ghost');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', function () {
                    render();
                });
            }
        })();
    </script>
</body>

</html>
{{ end }}